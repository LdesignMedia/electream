<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Eletream</title>

    <link rel="stylesheet" href="assets/css/photon.css">
    <link rel="stylesheet" href="assets/css/stream.css">
  </head>
  <body>
    <div class="window">
      <div class="window-content">
        <div class="pane-group">
          <div class="pane-mini sidebar">
            <a href="#" onclick="layout.show('#pane_main');">Main</a><br />
            <a href="#" onclick="layout.show('#pane_config');">Config</a><br />
            <a href="#" onclick="layout.show('#pane_log');">Log</a><br />
          </div>
          <div class="pane">
            <div id="pane_main" class="pane-content">
              <h1>Eletream</h1>
              Devices&nbsp;<span class="btn-primary icon icon-loop" onclick="refresh();"></span><br />
              Input Video Device: <select id="video_device"></select> <br />
              Input Audio Device: <select id="audio_device"></select> <br />
              <br />
              Destination (rtmp): <input type="text" class="save-field" id="output_stream"><br />
              <br />
              <br />
              <button class="btn btn-large btn-default" onclick="startStream();">Stream</button><br>
              <button class="btn btn-large btn-default" onclick="stopStream();">Stop</button><br>
            </div>

            <div id="pane_config" class="pane-content">
              <h1>Eletream - Config</h1>
              ffmpeg path: <input class="save-field" type="file" id="ffmpeg_path">
            </div>

            <div id="pane_log" class="pane-content">
              <h1>Electream - Log</h1>
              <div id="pane_log_content" style="overflow: none; width: 100%; height: 100%;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // You can also require other files to run in this process
      require('./renderer.js')
      const ffmpeg = require('./ffmpeg.js')
      const layout = require('./layout.js')
      const util = require('./util.js')
      const econfig = require('electron-config');
      const config = new econfig();

      function refresh() {
        ffmpeg.displayDevices("#video_device", "#audio_device");
      }
      refresh();
      window.$ = window.jQuery = require('jQuery');

      layout.show("#pane_main");

      $(".save-field").each(function(i, e) {
        e = $(e);
        var id = e.attr("id");

        // load all values from config
        e.val(config.get(id));

        e.bind("input", function() {
          config.set(id, e.val());
          console.log(`Saved ${id} val of ${e.val()}`);
        });
      });

      startStream = util.start;
      stopStream = util.stop;
    </script>
  </body>
</html>
